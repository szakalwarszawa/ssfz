{% extends "SsfzBundle::baseLayout.html.twig" %}

{% form_theme form _self %}

{%- block form_widget_simple -%}
    {%- set type = type|default('text') -%}
    {%- set attr = attr|merge({class: (attr.class|default('') ~ ' form-control text-right')|trim}) -%}
    <input type="{{ type }}" {{ block('widget_attributes') }} {% if value is not empty %}value="{{ value }}" {% endif %}/>
{%- endblock form_widget_simple -%}

{%- block integer_widget -%}
    {%- set type = type|default('number') -%}
    {%- set attr = attr|merge({class: (attr.class|default('') ~ ' form-control text-center')|trim}) -%}
    {{ block('form_widget_simple') }}
{%- endblock integer_widget -%}

{% block body %}
    <div class="panel panel-default">
        <div class="panel-heading">Dane poręczeń</div>
            <div class="panel-body">
                <div>
                    <span><strong>Numer umowy: </strong>{{ dane_poreczen.sprawozdanie.numerUmowy }}</span>
                    <br />
                    <span><strong>Okres sprawozdawczy: </strong>{{ dane_poreczen.sprawozdanie.okres }} {{ dane_poreczen.sprawozdanie.rok }}</span>
                </div>

                <div class="col-md-12">




                    <hr />
                    {{ form_start(form) }}
                        <h4>Dane dotyczące aktywnych poręczeń w sprawozdawanym okresie</h4>
                        <table class="table table-bordered table-condensed table-striped">
                            <tr>
                                <td rowspan="3" class="info credit-range col-md-1"></td>
                                <td colspan="3" class="text-center col-md-3"><strong>Według typu przedsiębiorstwa</strong></td>
                                <td colspan="6" class="text-center col-md-6"><strong>Według przeznaczenia</strong></td>
                                <td colspan="5" class="text-center col-md-5"><strong>Według działania pożyczkobiorcy</strong></td>
                                <td colspan="3" class="text-center col-md-3"><strong>Poręczenia udzielone</strong></td>
                            </tr>

                            <tr>
                                <td rowspan="2" class="text-center">Mikro</td>
                                <td rowspan="2" class="text-center">Małe</td>
                                <td rowspan="2" class="text-center">Śrdnie</td>
                                <td rowspan="2" class="text-center">kredyt obrotowy</td>
                                <td rowspan="2" class="text-center">kredyt inwestycyjny</td>
                                <td rowspan="2" class="text-center">pożyczka obrotowa</td>
                                <td rowspan="2" class="text-center">pożyczka inwestycyjna</td>
                                <td colspan="2" class="text-center">pozostale</td>
                                <td rowspan="2" class="text-center">produkcja</td>
                                <td rowspan="2" class="text-center">handel</td>
                                <td rowspan="2" class="text-center">usługi</td>
                                <td rowspan="2" class="text-center">budownictwo</td>
                                <td rowspan="2" class="text-center">inne</td>
                                <td rowspan="2" class="text-center">bankom</td>
                                <td rowspan="2" class="text-center">funduszom pożyczkowym</td>
                                <td rowspan="2" class="text-center">innym podmiotom</td>
                            </tr>

                            <tr>
                                <td class="text-center"></td>
                                <td class="text-center">w tym wadia</td>
                            </tr>

                            <tr>
                                <td colspan="18" class="info text-center"><strong>Liczba poręczeń (szt.)</strong></td>
                            </tr>

                            <tr>
                                <td class="text-center credit-range">do 50 000 zł</td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                            </tr>

                            <tr>
                                <td class="text-center credit-range">od 50 001 zł<br />do 100 000 zł</td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                            </tr>

                            <tr>
                                <td class="text-center credit-range">od 100 001 zł<br />do 500 000 zł</td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                            </tr>

                             <tr>
                                <td class="text-center credit-range">od 500 001 zł</td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                            </tr>

                            <tr>
                                <td colspan="18" class="info text-center"><strong>Wartość pożyczek (zł)</strong></td>
                            </tr>

                            <tr>
                                <td class="text-center credit-range">do 50 000 zł</td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                            </tr>

                            <tr>
                                <td class="text-center credit-range">od 50 001 zł<br />do 100 000 zł</td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                            </tr>

                            <tr>
                                <td class="text-center credit-range">od 100 001 zł<br />do 500 000 zł</td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                            </tr>

                             <tr>
                                <td class="text-center credit-range">od 500 001 zł</td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                                <td class="text-center"></td>
                            </tr>
                        </table>















                    <hr />

                    <h4> Podmioty współpracujące z funduszem</h4>
                    <div class="col-md-7">
                        <table class="table table-bordered table-condensed table-striped">
                            <tr>
                                <td><strong>Liczba podmiotów współpracujących z funduszem</strong></td>
                                <td class="text-center"><strong data-vertical-group-sum="34">0</strong></td>
                            </tr>
                            <tr>
                                <td>Liczba współpracujących banków</td>
                                <td class="text-center">{{ form_widget(form.liczbaWspolpracujacychBankow, {'attr': {'data-vertical-group': '34', 'data-horizontal-group': '9'}}) }}</td>
                            </tr>
                            <tr>
                                <td>Liczba współpracujących funduszy pożyczkowych</td>
                                <td class="text-center">{{ form_widget(form.liczbaWspolpracujacychFunduszyPozyczkowych, {'attr': {'data-vertical-group': '34', 'data-horizontal-group': '9'}}) }}</td>
                            </tr>
                            <tr>
                                <td>Liczba innych podmiotów współpracujących</td>
                                <td class="text-center">{{ form_widget(form.liczbaInnychPodmiotowWspolpracujacych, {'attr': {'data-vertical-group': '34', 'data-horizontal-group': '9'}}) }}</td>
                            </tr>
                        </table>
                    </div>

                    <div class="col-md-12">
                        <hr />
                        <br />
                        <a id="button_return"
                            class="btn btn-default"
                            href="{{ url('lista_sprawozdan_spo', {'umowa': dane_poreczen.sprawozdanie.umowaId}) }}"><i class="fas fa-chevron-left"></i> Powrót</a>
                        <button id="button_submit" type="submit" class="btn btn-success"><i class="fas fa-save"></i> Zapisz</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function () {
            function sumByGroup() {
                var verticalGroupsInteger = ['34'],
                    verticalGroupsDecimal = [],
                    horizontalGroupsInteger = ['9'],
                    horizontalGroupsDecimal = [],
                    sum = 0
                ;

                $.each(verticalGroupsInteger, function (index, value) {
                    $('[data-vertical-group='+value+']').each(function () {
                        sum = sum + parseInt($(this).val());
                    });
                    $('[data-vertical-group-sum='+value+']').text(sum);
                    sum = 0;
                });

                $.each(verticalGroupsDecimal, function (index, value) {
                    $('[data-vertical-group='+value+']').each(function () {
                        sum = sum + parseFloat($(this).maskMoney('unmasked')[0]);
                    });

                    sum = accounting.toFixed(sum, 2);
                    sum = accounting.formatMoney(sum, {
                        symbol: ' zł',
                        precision: 2,
                        decinal: '.',
                        thousand: ' ',
                        format: "%v%s"
                    });

                    $('[data-vertical-group-sum='+value+']').text(sum);
                    sum = 0;
                });
            }

            $('[data-vertical-group]').change(function () {
                sumByGroup();
            });

            $('.decimal-11-2').maskMoney({
                prefix: '',
                suffix: ' zł',
                affixesStay: false,
                thousands: ' ',
                decimal: '.',
                precision: 2,
                allowZero: true,
                allowNegative: false,
                allowEmpty: false,
                reverse: false
            });

            sumByGroup();
        });
    </script>
{% endblock %}
